# ç¾¤ç»„ç»‘å®šæ’ä»¶

ç¾¤ç»„ç»‘å®šæ’ä»¶å…è®¸å°†å¤šä¸ªç¾¤ç»„ç»‘å®šåœ¨ä¸€èµ·ï¼Œå®ç°è·¨ç¾¤ç»„çš„åŠŸèƒ½åŒæ­¥ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”— **ç¾¤ç»„ç»‘å®š**ï¼šå°†å½“å‰ç¾¤ç»„ç»‘å®šåˆ°æŒ‡å®šçš„ç›®æ ‡ç¾¤ç»„
- ğŸ”„ **ç»‘å®šæ›´æ–°**ï¼šå¦‚æœå·²ç»‘å®šï¼Œå¯ä»¥æ›´æ–°ç»‘å®šçš„ç›®æ ‡ç¾¤ç»„
- ğŸ”“ **è§£é™¤ç»‘å®š**ï¼šå°†å½“å‰ç¾¤ç»„ä»ç»‘å®šå…³ç³»ä¸­ç§»é™¤
- ğŸ“‹ **æŸ¥çœ‹çŠ¶æ€**ï¼šæŸ¥çœ‹å½“å‰ç¾¤ç»„çš„ç»‘å®šçŠ¶æ€
- ğŸ‘¥ **è·å–ç»‘å®šç¾¤ç»„åˆ—è¡¨**ï¼šè·å–æ‰€æœ‰ç»‘å®šåˆ°åŒä¸€ç›®æ ‡çš„ç¾¤ç»„IDåˆ—è¡¨

## å‘½ä»¤ä½¿ç”¨

### ç»‘å®šç¾¤ç»„

```bash
/ç»‘å®šç¾¤ç»„ <ç›®æ ‡ç¾¤ç»„ID>
```

å°†å½“å‰ç¾¤ç»„ç»‘å®šåˆ°æŒ‡å®šçš„ç›®æ ‡ç¾¤ç»„ã€‚å¦‚æœå½“å‰ç¾¤ç»„å·²ç»ç»‘å®šåˆ°å…¶ä»–ç¾¤ç»„ï¼Œä¼šæ›´æ–°ç»‘å®šå…³ç³»ã€‚

**ç¤ºä¾‹**ï¼š

```bash
/ç»‘å®šç¾¤ç»„ 123456789
```

### è§£ç»‘ç¾¤ç»„

```bash
/è§£ç»‘ç¾¤ç»„
```

å°†å½“å‰ç¾¤ç»„ä»ç»‘å®šå…³ç³»ä¸­ç§»é™¤ã€‚

### æŸ¥çœ‹ç»‘å®šçŠ¶æ€

```bash
/æŸ¥çœ‹ç»‘å®š
```

æŸ¥çœ‹å½“å‰ç¾¤ç»„æ˜¯å¦å·²ç»‘å®šä»¥åŠç»‘å®šçš„ç›®æ ‡ç¾¤ç»„IDã€‚

## æƒé™è¦æ±‚

æ‰€æœ‰å‘½ä»¤éƒ½éœ€è¦**è¶…çº§ç”¨æˆ·æƒé™**æ‰èƒ½æ‰§è¡Œã€‚

## ä½¿ç”¨åœºæ™¯

1. **å¤šç¾¤åŒæ­¥**ï¼šå°†å¤šä¸ªç›¸å…³ç¾¤ç»„ç»‘å®šåœ¨ä¸€èµ·ï¼Œå®ç°åŠŸèƒ½çš„ç»Ÿä¸€ç®¡ç†
2. **ç¾¤ç»„è¿ç§»**ï¼šå½“éœ€è¦æ›´æ¢ä¸»ç¾¤æ—¶ï¼Œå¯ä»¥æ›´æ–°ç»‘å®šå…³ç³»
3. **åˆ†ç¾¤ç®¡ç†**ï¼šå¯¹äºæœ‰å¤šä¸ªåˆ†ç¾¤çš„å¤§å‹ç¤¾åŒºï¼Œå¯ä»¥å°†åˆ†ç¾¤ç»‘å®šåˆ°ä¸»ç¾¤

## ç»‘å®šå…³ç³»è¯´æ˜

### ç»‘å®šæ¨¡å¼

- ç¾¤ç»„ç»‘å®šé‡‡ç”¨**å¤šå¯¹ä¸€**çš„æ¨¡å¼
- å¤šä¸ªç¾¤ç»„å¯ä»¥ç»‘å®šåˆ°åŒä¸€ä¸ªç›®æ ‡ç¾¤ç»„
- ä¸€ä¸ªç¾¤ç»„åªèƒ½ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡ç¾¤ç»„

### ç¤ºä¾‹åœºæ™¯

å‡è®¾æœ‰ç¾¤ç»„ Aã€Bã€Cï¼š

- ç¾¤ç»„ B ç»‘å®šåˆ°ç¾¤ç»„ A
- ç¾¤ç»„ C ç»‘å®šåˆ°ç¾¤ç»„ A
- æ­¤æ—¶ A æ˜¯ç›®æ ‡ç¾¤ç»„ï¼ŒB å’Œ C æ˜¯ç»‘å®šç¾¤ç»„

è°ƒç”¨ `get_bound_session_ids("B")` ä¼šè¿”å› `["A", "B", "C"]`

## API æ¥å£

### GroupBindService ç±»

æ’ä»¶æä¾›äº† `GroupBindService` ç±»ï¼ŒåŒ…å«ä»¥ä¸‹æ–¹æ³•ï¼š

#### `bind_group(session_id: str, bind_id: str)`

ç»‘å®šç¾¤ç»„åˆ°ç›®æ ‡ç¾¤ç»„ï¼Œå¦‚æœå·²ç»‘å®šåˆ™æ›´æ–°ç»‘å®šå…³ç³»ã€‚

#### `unbind_group(session_id: str)`

è§£é™¤ç¾¤ç»„ç»‘å®šã€‚

#### `get_bind_id(session_id: str) -> str`

è·å–ç¾¤ç»„ç»‘å®šçš„ç›®æ ‡ç¾¤ç»„IDï¼Œå¦‚æœæœªç»‘å®šåˆ™è¿”å›è‡ªèº«IDã€‚

#### `get_bound_session_ids(session_id: str) -> list[str]`

è·å–æ‰€æœ‰ç»‘å®šåˆ°åŒä¸€ç›®æ ‡çš„ç¾¤ç»„IDåˆ—è¡¨ã€‚

#### `is_group_bound(session_id: str) -> bool`

æ£€æŸ¥ç¾¤ç»„æ˜¯å¦å·²ç»‘å®šã€‚

### ä½¿ç”¨ç¤ºä¾‹

```python
from src.plugins.group_bind.data_source import group_bind_service

# ç»‘å®šç¾¤ç»„
await group_bind_service.bind_group("group_1", "group_main")

# è·å–ç»‘å®šçš„ç›®æ ‡ç¾¤ç»„
bind_id = await group_bind_service.get_bind_id("group_1")

# è·å–æ‰€æœ‰ç»‘å®šç¾¤ç»„
bound_groups = await group_bind_service.get_bound_session_ids("group_1")

# æ£€æŸ¥æ˜¯å¦å·²ç»‘å®š
is_bound = await group_bind_service.is_group_bound("group_1")

# è§£é™¤ç»‘å®š
await group_bind_service.unbind_group("group_1")
```

## æ•°æ®æ¨¡å‹

### GroupBind

```python
class GroupBind(Model):
    id: Mapped[int]  # ä¸»é”®
    session_id: Mapped[str]  # ç¾¤ç»„ID
    bind_id: Mapped[str]  # ç»‘å®šçš„ç›®æ ‡ç¾¤ç»„ID
```

## ä¾èµ–æ’ä»¶

- `nonebot_plugin_orm`ï¼šORM æ”¯æŒ
- `nonebot_plugin_user`ï¼šç”¨æˆ·ä¼šè¯ç®¡ç†
- `nonebot_plugin_alconna`ï¼šå‘½ä»¤è§£æ
- `nonebot_plugin_uninfo`ï¼šç»Ÿä¸€ä¿¡æ¯æ¥å£

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰å‘½ä»¤åªèƒ½åœ¨ç¾¤ç»„ç¯å¢ƒä¸­ä½¿ç”¨
2. ä¸èƒ½å°†ç¾¤ç»„ç»‘å®šåˆ°è‡ªå·±
3. ç»‘å®šå…³ç³»æ˜¯æŒä¹…åŒ–çš„ï¼Œä¼šä¿å­˜åˆ°æ•°æ®åº“ä¸­
4. è§£ç»‘æ—¶å¦‚æœç¾¤ç»„æœªç»‘å®šä¼šæŠ›å‡ºé”™è¯¯
5. ç¾¤ç»„ç»‘å®šæ›´æ–°æ˜¯åŸå­æ“ä½œï¼Œä¸ä¼šå‡ºç°ä¸­é—´çŠ¶æ€

## é”™è¯¯å¤„ç†

- å½“å°è¯•è§£ç»‘æœªç»‘å®šçš„ç¾¤ç»„æ—¶ï¼Œä¼šæŠ›å‡º `ValueError`
- å…¶ä»–æ•°æ®åº“æ“ä½œé”™è¯¯ä¼šå‘ä¸Šä¼ æ’­
- å‘½ä»¤å¤„ç†ä¸­çš„é”™è¯¯ä¼šé€šè¿‡æœºå™¨äººæ¶ˆæ¯åé¦ˆç»™ç”¨æˆ·
